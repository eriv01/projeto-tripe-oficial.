<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Protocolo TRIPE - Oficial</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #ef4444; --bg: #0a0a0a; --card: #141414; --text: #ffffff; --muted: #9ca3af; --border: #262626; }
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg ); color: var(--text); min-height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; }
        .quiz-card { width: 100%; max-width: 450px; background: var(--card); border: 1px solid var(--border); border-radius: 24px; padding: 30px; box-shadow: 0 20px 40px rgba(0,0,0,0.6); }
        .fixed-header { font-size: 10px; font-weight: 900; color: var(--primary); text-transform: uppercase; letter-spacing: 2px; margin-bottom: 20px; }
        .progress-bar { height: 4px; background: var(--border); border-radius: 10px; margin-bottom: 30px; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--primary); width: 0%; transition: width 0.3s ease; }
        .question-title { font-size: 24px; font-weight: 900; margin-bottom: 15px; line-height: 1.3; }
        .question-subtitle { font-size: 14px; color: var(--muted); margin-bottom: 25px; }
        .options-grid { display: grid; gap: 12px; margin-bottom: 25px; }
        .option-btn { background: var(--card); border: 2px solid var(--border); color: var(--text); padding: 16px; border-radius: 12px; cursor: pointer; font-weight: 600; transition: all 0.2s; text-align: left; }
        .option-btn:hover { border-color: var(--primary); background: rgba(239, 68, 68, 0.1); }
        .option-btn.selected { border-color: var(--primary); background: rgba(239, 68, 68, 0.2); }
        .btn-next { background: var(--primary); color: white; border: none; padding: 16px; border-radius: 12px; font-weight: 900; cursor: pointer; width: 100%; font-size: 16px; transition: 0.2s; }
        .btn-next:hover { background: #dc2626; }
        .btn-next:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn-prev { background: var(--border); color: var(--text); border: none; padding: 12px; border-radius: 10px; font-weight: 700; cursor: pointer; width: 100%; margin-top: 10px; transition: 0.2s; }
        .btn-prev:hover { background: #3a3a3a; }

        /* Tela de Processamento */
        .processing-screen { display: none; text-align: center; }
        .processing-screen.active { display: block; }
        .urgency-badge { background: rgba(239, 68, 68, 0.2); border: 2px solid var(--primary); padding: 10px 15px; border-radius: 50px; display: inline-block; margin-bottom: 25px; font-weight: 900; color: var(--primary); font-size: 13px; }
        .carousel-container { width: 100%; height: 350px; background: linear-gradient(135deg, #1a1a1a 0%, #0d0d0d 100%); border-radius: 20px; margin: 25px 0; overflow: hidden; position: relative; display: flex; align-items: center; justify-content: center; }
        .carousel-slide { position: absolute; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; opacity: 0; transition: opacity 0.5s ease; }
        .carousel-slide.active { opacity: 1; }
        .carousel-slide img { width: 100%; height: 100%; object-fit: cover; border-radius: 20px; }
        .carousel-caption { position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(to top, rgba(0,0,0,0.9), transparent); padding: 20px; text-align: center; color: white; }
        .carousel-caption h4 { font-size: 18px; font-weight: 900; margin-bottom: 5px; }
        .carousel-caption p { font-size: 13px; color: var(--muted); }
        .processing-steps { margin: 30px 0; }
        .processing-step { margin-bottom: 20px; text-align: left; }
        .step-label { font-size: 12px; color: var(--muted); margin-bottom: 8px; font-weight: 700; }
        .step-bar { height: 6px; background: var(--border); border-radius: 10px; overflow: hidden; }
        .step-fill { height: 100%; background: var(--primary); width: 0%; animation: fill 2s ease-in-out infinite; }
        @keyframes fill { 0% { width: 0%; } 50% { width: 100%; } 100% { width: 100%; } }
        .processing-message { font-size: 14px; color: var(--muted); margin-top: 25px; line-height: 1.6; }
        .processing-message strong { color: var(--text); }

        /* Resultado */
        .result-screen { display: none; text-align: center; }
        .result-screen.active { display: block; }
        .result-badge { background: var(--primary); color: white; padding: 15px; border-radius: 15px; margin-bottom: 20px; font-weight: 900; font-size: 28px; }
        .result-text { font-size: 16px; color: var(--muted); margin-bottom: 20px; line-height: 1.6; }
        .result-highlight { color: var(--primary); font-weight: 900; font-size: 18px; }
        .cta-button { background: var(--primary); color: white; border: none; padding: 18px; border-radius: 12px; font-weight: 900; cursor: pointer; width: 100%; font-size: 16px; margin-top: 20px; transition: 0.2s; }
        .cta-button:hover { background: #dc2626; }

        @media (max-width: 480px) {
            .quiz-card { padding: 20px; }
            .question-title { font-size: 20px; }
            .carousel-container { height: 300px; }
        }
    </style>
</head>
<body>
    <div class="quiz-card">
        <!-- Tela de Perguntas -->
        <div id="questionsScreen">
            <div class="fixed-header">AVALIA√á√ÉO PERSONALIZADA - M√âTODO TRIPE</div>
            <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
            <div id="questionContent"></div>
            <button class="btn-next" id="nextBtn" onclick="window.next()" disabled>PR√ìXIMA PERGUNTA</button>
            <button class="btn-prev" id="prevBtn" onclick="window.prev()" style="display:none;">‚Üê VOLTAR</button>
        </div>

        <!-- Tela de Processamento -->
        <div id="processingScreen" class="processing-screen">
            <div class="urgency-badge" id="urgencyBadge">üî• 147 homens avaliando o membro agora</div>
            <div class="fixed-header">PROCESSANDO DADOS...</div>
            <div class="carousel-container" id="carouselContainer">
                <div class="carousel-slide active">
                    <img src="https://metodotripe.shop/wp-content/uploads/2026/01/paciente-D-antes-e-depois-alongamento-peniano-faloplastia-fotor-20260119195743.png" alt="Resultado 1">
                    <div class="carousel-caption">
                        <h4>Ricardo, 34 anos</h4>
                        <p>+4.2cm em 28 dias</p>
                    </div>
                </div>
                <div class="carousel-slide">
                    <img src="https://metodotripe.shop/wp-content/uploads/2026/01/WhatsApp-Image-2024-12-18-at-15.11.46-rcl53qv1p0gr5s3fzr30gvvchnyybvpbhth13gqhj4.jpeg" alt="Resultado 2">
                    <div class="carousel-caption">
                        <h4>Marcelo, 41 anos</h4>
                        <p>+3.8cm em 30 dias</p>
                    </div>
                </div>
                <div class="carousel-slide">
                    <img src="https://metodotripe.shop/wp-content/uploads/2026/01/seja-malicioso-na-cama-pro-1.png" alt="Resultado 3">
                    <div class="carousel-caption">
                        <h4>Felipe, 28 anos</h4>
                        <p>+5.1cm em 35 dias</p>
                    </div>
                </div>
            </div>
            <div class="processing-steps">
                <div class="processing-step">
                    <div class="step-label">‚úì Analisando tecidos cavernosos</div>
                    <div class="step-bar"><div class="step-fill"></div></div>
                </div>
                <div class="processing-step">
                    <div class="step-label">‚è≥ Calculando limite de expans√£o</div>
                    <div class="step-bar"><div class="step-fill" style="animation-delay: 0.5s;"></div></div>
                </div>
                <div class="processing-step">
                    <div class="step-label">‚è≥ Cruzando dados de fluxo sangu√≠neo</div>
                    <div class="step-bar"><div class="step-fill" style="animation-delay: 1s;"></div></div>
                </div>
            </div>
            <div class="processing-message">
                <strong>Seu diagn√≥stico est√° sendo gerado...</strong>  

                Analisando seu perfil de resposta e comparando com <strong>10.847 casos de sucesso</strong> do M√©todo TRIPE.
            </div>
        </div>

        <!-- Tela de Resultado -->
        <div id="resultScreen" class="result-screen">
            <div class="fixed-header">SEU RESULTADO PERSONALIZADO</div>
            <div class="result-badge" id="resultBadge">+4.5cm</div>
            <div class="result-text">
                Baseado nas suas respostas, voc√™ pode alcan√ßar um ganho de <span class="result-highlight" id="resultValue">+4.5cm</span> em <strong>30 dias</strong> com o M√©todo TRIPE.
            </div>
            <div id="blockagesAlert" style="background: rgba(239, 68, 68, 0.1 ); border-left: 4px solid var(--primary); padding: 15px; border-radius: 8px; margin: 20px 0; text-align: left; font-size: 13px; color: var(--muted);"></div>
            <div class="result-text">
                <strong>Voc√™ est√° a um passo de transformar seu desempenho sexual.</strong>  
  

                Clique abaixo para acessar o protocolo completo e come√ßar hoje mesmo.
            </div>
            <button class="cta-button" id="ctaButton" onclick="window.finish()">ACESSAR PROTOCOLO TRIPE</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, set, update, get, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

        const firebaseConfig = {
            apiKey: "AIzaSyCDYmSVU2xVVuLw0vu3svKI7n4hvdxjW0w",
            authDomain: "projeto-tripe-oficial.firebaseapp.com",
            databaseURL: "https://projeto-tripe-oficial-default-rtdb.firebaseio.com",
            projectId: "projeto-tripe-oficial",
            storageBucket: "projeto-tripe-oficial.firebasestorage.app",
            messagingSenderId: "274742031259",
            appId: "1:274742031259:web:18dc5c086fe3d58b56673e"
        };

        const app = initializeApp(firebaseConfig );
        const db = getDatabase(app);
        let userRef = null;
        let currentStep = 0;
        let selectedVariants = { saudacao: 0, resultado: 0, cta: 0 };
        let answers = {};
        let sessionId = null;
        let stepStartTime = 0;

        const SALUTATIONS = [
            { title: "VOC√ä EST√Å A UM PASSO...", subtitle: "De descobrir seu verdadeiro potencial sexual" },
            { title: "ESPERA ABRINDO...", subtitle: "Seu diagn√≥stico de ganho peniano personalizado" },
            { title: "CARREGANDO PROTOCOLO...", subtitle: "Que vai transformar sua vida sexual" },
            { title: "INICIANDO AVALIA√á√ÉO...", subtitle: "Baseada em 10.847 casos de sucesso" },
            { title: "PREPARANDO RESULTADO...", subtitle: "Que vai surpreender voc√™" }
        ];

        const QUESTIONS = [
            { id: 'ere√ß√£o', title: 'Qual sua frequ√™ncia de ere√ß√£o matinal?', options: ['Quase nunca', 'Raramente', '√Äs vezes', 'Frequentemente', 'Sempre'] },
            { id: 'sono', title: 'Quantas horas voc√™ dorme por noite?', options: ['Menos de 5h', '5-6h', '6-7h', '7-8h', 'Mais de 8h'] },
            { id: 'dieta', title: 'Como √© sua alimenta√ß√£o?', options: ['Muito ruim', 'Ruim', 'M√©dia', 'Boa', 'Excelente'] },
            { id: 'exercicio', title: 'Qual sua frequ√™ncia de exerc√≠cios?', options: ['Nunca', '1-2x/semana', '3-4x/semana', '5-6x/semana', 'Diariamente'] },
            { id: 'estresse', title: 'Como voc√™ avalia seu n√≠vel de estresse?', options: ['Muito alto', 'Alto', 'Moderado', 'Baixo', 'Muito baixo'] },
            { id: 'desempenho', title: 'Como √© seu desempenho sexual?', options: ['Muito ruim', 'Ruim', 'M√©dio', 'Bom', 'Excelente'] },
            { id: 'duracao', title: 'Quanto tempo voc√™ dura na cama?', options: ['Menos de 2min', '2-5min', '5-10min', '10-15min', 'Mais de 15min'] }
        ];

        const RESULTS = [
            { title: "Seu Potencial √© EXTRAORDIN√ÅRIO!", value: 5.0, blockage: null },
            { title: "Ganho Significativo Poss√≠vel", value: 4.5, blockage: null },
            { title: "Ganho Moderado Esperado", value: 3.5, blockage: "Voc√™ pode estar perdendo potencial por falta de sono adequado." },
            { title: "Ganho Moderado Esperado", value: 3.0, blockage: "Dieta inflamat√≥ria pode estar limitando seu crescimento." },
            { title: "Ganho Limitado Detectado", value: 2.0, blockage: "Estresse cr√¥nico est√° bloqueando sua expans√£o natural." }
        ];

        function render() {
            if (currentStep < QUESTIONS.length) {
                renderQuestion();
            } else if (currentStep === QUESTIONS.length) {
                renderProcessing();
            } else {
                renderResult();
            }
        }

        function renderQuestion() {
            const q = QUESTIONS[currentStep];
            const progress = ((currentStep + 1) / QUESTIONS.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            
            let html = '<div class="question-title">' + q.title + '</div>';
            html += '<div class="options-grid">';
            q.options.forEach((opt, i) => {
                const selected = answers[q.id] === i ? 'selected' : '';
                html += '<button class="option-btn ' + selected + '" onclick="window.selectOption(\'' + q.id + '\', ' + i + ')">' + opt + '</button>';
            });
            html += '</div>';
            
            document.getElementById('questionContent').innerHTML = html;
            document.getElementById('nextBtn').disabled = answers[q.id] === undefined;
            document.getElementById('prevBtn').style.display = currentStep > 0 ? 'block' : 'none';
            document.getElementById('questionsScreen').style.display = 'block';
            document.getElementById('processingScreen').classList.remove('active');
            document.getElementById('resultScreen').classList.remove('active');
        }

        function renderProcessing() {
            document.getElementById('questionsScreen').style.display = 'none';
            document.getElementById('processingScreen').classList.add('active');
            document.getElementById('resultScreen').classList.remove('active');
            
            // Atualizar contador de urg√™ncia
            const randomUsers = Math.floor(Math.random() * 60) + 120;
            document.getElementById('urgencyBadge').textContent = 'üî• ' + randomUsers + ' homens avaliando o membro agora';
            
            // Carrossel autom√°tico
            let currentSlide = 0;
            setInterval(() => {
                document.querySelectorAll('.carousel-slide').forEach(s => s.classList.remove('active'));
                currentSlide = (currentSlide + 1) % 3;
                document.querySelectorAll('.carousel-slide')[currentSlide].classList.add('active');
            }, 4000);
            
            // Simular processamento
            setTimeout(() => {
                currentStep++;
                render();
            }, 5000);
        }

        function renderResult() {
            document.getElementById('questionsScreen').style.display = 'none';
            document.getElementById('processingScreen').classList.remove('active');
            document.getElementById('resultScreen').classList.add('active');
            
            // Calcular resultado baseado nas respostas
            let score = 5;
            if (answers['ere√ß√£o'] <= 1) score -= 1;
            if (answers['sono'] <= 1) score -= 1.5;
            if (answers['dieta'] <= 1) score -= 1;
            if (answers['exercicio'] <= 1) score -= 0.5;
            if (answers['estresse'] >= 3) score -= 1;
            
            score = Math.max(2, Math.min(5, score));
            const resultIdx = Math.round(score) - 2;
            const result = RESULTS[resultIdx] || RESULTS[2];
            
            document.getElementById('resultBadge').textContent = '+' + result.value.toFixed(1) + 'cm';
            document.getElementById('resultValue').textContent = '+' + result.value.toFixed(1) + 'cm';
            
            let blockageHtml = '';
            if (result.blockage) {
                blockageHtml = '<strong>‚ö†Ô∏è BLOQUEIO DETECTADO:</strong>  
' + result.blockage;
            } else {
                blockageHtml = '<strong>‚úÖ NENHUM BLOQUEIO DETECTADO</strong>  
Voc√™ tem o perfil ideal para m√°ximo ganho com o M√©todo TRIPE.';
            }
            document.getElementById('blockagesAlert').innerHTML = blockageHtml;
        }

        async function init() {
            sessionId = 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            userRef = ref(db, 'sessions/' + sessionId);
            
            try {
                const variantsSnap = await get(ref(db, 'optimization/variants'));
                if (variantsSnap.exists()) {
                    const variants = variantsSnap.val();
                    const indices = [0, 1, 2, 3, 4];
                    ['saudacao', 'resultado', 'cta'].forEach(t => {
                        const active = indices.filter(i => variants[t + '_' + i] && variants[t + '_' + i].active);
                        if (active.length > 0) {
                            selectedVariants[t] = active[Math.floor(Math.random() * active.length)];
                        }
                    });
                }
                
                const winnerSnap = await get(ref(db, 'optimization/winner'));
                if (winnerSnap.exists()) {
                    const winner = winnerSnap.val();
                    selectedVariants = winner;
                }
                
                await set(userRef, { enteredAt: serverTimestamp(), status: 'active', variants: selectedVariants });
                render();
            } catch (e) {
                console.error(e);
                render();
            }
        }

        window.selectOption = (id, val) => {
            answers[id] = val;
            render();
        };

        window.next = () => {
            currentStep++;
            render();
        };

        window.prev = () => {
            if (currentStep > 0) {
                currentStep--;
                render();
            }
        };

        window.finish = async () => {
            if (userRef) {
                await update(userRef, { currentStep: 99, status: 'converted', lastUpdate: serverTimestamp() });
            }
            window.location.href = "https://pay.wiapy.com/w-U6oehEBd";
        };

        init( );
    </script>
</body>
</html>
