<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Método TRIPE - Avaliação Oficial</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #ef4444; --bg: #000000; --card: #0f0f0f; --text: #ffffff; --muted: #9ca3af; --border: #262626; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: var(--bg ); color: var(--text); display: flex; align-items: center; justify-content: center; min-height: 100vh; padding: 20px; }
        #quiz-container { width: 100%; max-width: 450px; }
        .card { background: var(--card); border: 1px solid var(--border); padding: 30px; border-radius: 24px; box-shadow: 0 20px 40px rgba(0,0,0,0.5); position: relative; }
        
        /* CARROSSEL DE PROVAS SOCIAIS */
        .carousel { width: 100%; height: 250px; border-radius: 15px; margin-bottom: 20px; position: relative; overflow: hidden; border: 1px solid var(--border); }
        .carousel-inner { display: flex; width: 400%; height: 100%; transition: transform 0.5s ease-in-out; }
        .carousel-item { width: 25%; height: 100%; flex-shrink: 0; }
        .carousel-item img { width: 100%; height: 100%; object-fit: cover; }
        
        .progress-bar { width: 100%; height: 6px; background: var(--border); border-radius: 10px; margin-bottom: 30px; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--primary); transition: width 0.3s ease; }
        h2 { font-size: 24px; font-weight: 900; line-height: 1.2; margin-bottom: 15px; }
        p { color: var(--muted); font-size: 15px; line-height: 1.5; margin-bottom: 30px; }
        .btn { width: 100%; background: var(--primary); color: white; border: none; padding: 18px; border-radius: 12px; font-size: 16px; font-weight: 900; cursor: pointer; transition: transform 0.2s; text-transform: uppercase; }
        .btn-opt { width: 100%; background: transparent; color: white; border: 1px solid var(--border); padding: 15px; border-radius: 12px; font-size: 15px; font-weight: 600; cursor: pointer; text-align: left; margin-bottom: 10px; transition: all 0.2s; }
        .btn-opt:hover { border-color: var(--primary); background: rgba(239, 68, 68, 0.05); }
        .animate-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    <div id="quiz-container"></div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, set, update, get, serverTimestamp, increment } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

        const firebaseConfig = {
            apiKey: "AIzaSyCDYmSVU2xVVuLw0vu3svKI7n4hvdxjW0w",
            authDomain: "projeto-tripe-oficial.firebaseapp.com",
            databaseURL: "https://projeto-tripe-oficial-default-rtdb.firebaseio.com",
            projectId: "projeto-tripe-oficial",
            storageBucket: "projeto-tripe-oficial.firebasestorage.app",
            messagingSenderId: "274742031259",
            appId: "1:274742031259:web:18dc5c086fe3d58b56673e"
        };

        const app = initializeApp(firebaseConfig );
        const db = getDatabase(app);
        const sid = 's_' + Date.now() + Math.random().toString(36).substr(2, 5);

        let step = 0, qIdx = 0, variantIdx = 0, carouselIdx = 0;

        const SALUTATIONS = [
            { title: "VOCÊ ESTÁ A UM PASSO...", subtitle: "De descobrir seu verdadeiro potencial sexual" },
            { title: "ESPERA ABRINDO...", subtitle: "Seu diagnóstico de ganho peniano personalizado" },
            { title: "CARREGANDO PROTOCOLO...", subtitle: "Que vai transformar sua vida sexual" },
            { title: "INICIANDO AVALIAÇÃO...", subtitle: "Baseada em 10.847 casos de sucesso" },
            { title: "PREPARANDO RESULTADO...", subtitle: "Que vai surpreender você" }
        ];

        const RESULTS_COPY = [
            "Você pode ganhar até 5 a 7cm em 30 dias.",
            "Diagnóstico: Seu potencial é de 5 a 7cm extras.",
            "ATENÇÃO: Você tem um potencial reprimido de 5 a 7cm.",
            "Resultado: Seu membro pode atingir 5 a 7cm extras.",
            "Parabéns! Você pode ganhar 5 a 7cm em 4 semanas."
        ];

        const CTA_COPY = ["ACESSAR PROTOCOLO TRIPE", "QUERO MEU MEMBRO MAIOR AGORA", "LIBERAR ACESSO AO MÉTODO", "COMEÇAR MINHA TRANSFORMAÇÃO", "SIM! QUERO AUMENTAR MEU PÊNIS"];

        const qs = [
            { q: "Qual sua idade?", a: ["18-25", "26-35", "36-45", "46+"] },
            { q: "Já tentou algum método antes?", a: ["Nunca tentei", "Exercícios", "Bombas/Extensores", "Suplementos"] },
            { q: "Qual seu objetivo principal?", a: ["Ganhar comprimento", "Ganhar espessura", "Mais disposição", "Controle total"] },
            { q: "Quanto tempo você tem disponível?", a: ["5 min/dia", "15 min/dia", "30 min/dia", "O tempo que for preciso"] },
            { q: "Sente que seu desempenho poderia ser melhor?", a: ["Sim, muito", "Sim, um pouco", "Às vezes", "Não, estou satisfeito"] },
            { q: "Como está sua confiança hoje?", a: ["Baixa", "Média", "Alta", "Oscilante"] },
            { q: "Qual sua maior frustração?", a: ["Tamanho", "Duração", "Ereção", "Autoestima"] },
            { q: "Já ouviu falar do Método TRIPE?", a: ["Sim", "Não", "Já vi anúncios", "Um amigo indicou"] },
            { q: "Está disposto a seguir o passo a passo?", a: ["Sim, 100%", "Vou tentar", "Se der resultado rápido", "Talvez"] },
            { q: "Podemos iniciar seu protocolo?", a: ["SIM, AGORA!", "VAMOS!", "QUERO VER MEU RESULTADO", "ESTOU PRONTO"] }
        ];

        window.next = function() {
            step++;
            if (step <= 10) qIdx = step - 1;
            update(ref(db, 'sessions/' + sid), { currentStep: step, lastUpdate: serverTimestamp() });
            render();
        };

        window.finish = function() { 
            update(ref(db, 'sessions/' + sid), { status: 'checkout_clicked', lastUpdate: serverTimestamp() });
            window.location.href = "https://pay.wiapy.com/w-U6oehEBd?utm_source=" + sid; 
        };

        function startCarousel( ) {
            setInterval(() => {
                const inner = document.querySelector('.carousel-inner');
                if (inner) {
                    carouselIdx = (carouselIdx + 1) % 4;
                    inner.style.transform = `translateX(-${carouselIdx * 25}%)`;
                }
            }, 2000);
        }

        function render() {
            const container = document.getElementById('quiz-container');
            if (step === 0) {
                const s = SALUTATIONS[variantIdx];
                container.innerHTML = `
                    <div class="card animate-in">
                        <div class="carousel">
                            <div class="carousel-inner">
                                <div class="carousel-item"><img src="https://fiapy.nyc3.cdn.digitaloceanspaces.com/static/68caaacc172c5fe114f8ee83/188c4e7f25ec7eac3294_-_desenvolvimento%20masculino%20%20%282%29.pdf" alt="Resultado 1"></div>
                                <div class="carousel-item"><img src="https://fiapy.nyc3.cdn.digitaloceanspaces.com/static/68caaacc172c5fe114f8ee83/188c4e7f25ec7eac3294_-_desenvolvimento%20masculino%20%20%282%29.pdf" alt="Resultado 2"></div>
                                <div class="carousel-item"><img src="https://fiapy.nyc3.cdn.digitaloceanspaces.com/static/68caaacc172c5fe114f8ee83/188c4e7f25ec7eac3294_-_desenvolvimento%20masculino%20%20%282%29.pdf" alt="Resultado 3"></div>
                                <div class="carousel-item"><img src="https://fiapy.nyc3.cdn.digitaloceanspaces.com/static/68caaacc172c5fe114f8ee83/188c4e7f25ec7eac3294_-_desenvolvimento%20masculino%20%20%282%29.pdf" alt="Resultado 4"></div>
                            </div>
                        </div>
                        <h2>${s.title}</h2>
                        <p>${s.subtitle}</p>
                        <button class="btn" onclick="next( )">CONTINUAR</button>
                    </div>`;
                startCarousel();
            } else if (step <= 10) {
                const q = qs[qIdx];
                container.innerHTML = `
                    <div class="card animate-in">
                        <div class="progress-bar"><div class="progress-fill" style="width: ${step * 10}%"></div></div>
                        <p style="font-size: 12px; font-weight: 900; color: var(--primary); margin-bottom: 10px;">PERGUNTA ${step} DE 10</p>
                        <h2>${q.q}</h2>
                        <div style="display: flex; flex-direction: column; gap: 10px;">
                            ${q.a.map(opt => `<button class="btn-opt" onclick="next()">${opt}</button>`).join('')}
                        </div>
                    </div>`;
            } else {
                container.innerHTML = `
                    <div class="card animate-in" style="text-align: center;">
                        <h2 style="color: #22c55e; margin-bottom: 10px;">PROTOCOLO GERADO!</h2>
                        <p style="font-size: 18px; font-weight: 900; color: white; margin-bottom: 25px;">${RESULTS_COPY[variantIdx]}</p>
                        <button class="btn" onclick="finish()">${CTA_COPY[variantIdx]}</button>
                    </div>`;
            }
        }

        async function start() {
            try {
                const totalSnap = await get(ref(db, 'optimization/totalSessions'));
                const total = totalSnap.exists() ? totalSnap.val() : 0;
                variantIdx = Math.floor(total / 10) % 5;
                
                set(ref(db, 'sessions/' + sid), { 
                    enteredAt: serverTimestamp(), 
                    status: 'active', 
                    variantIdx: variantIdx, 
                    currentStep: 0,
                    lastUpdate: serverTimestamp()
                });
                update(ref(db, 'optimization'), { totalSessions: increment(1) });
            } catch (e) { console.error(e); }
            render();
        }

        start();
    </script>
</body>
</html>
