<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Protocolo TRIPE - Oficial</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #ef4444; --bg: #0a0a0a; --card: #141414; --text: #ffffff; --muted: #9ca3af; --border: #262626; }
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg ); color: var(--text); min-height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; }
        .quiz-card { width: 100%; max-width: 450px; background: var(--card); border: 1px solid var(--border); border-radius: 24px; padding: 30px; box-shadow: 0 20px 40px rgba(0,0,0,0.6); }
        .fixed-header { font-size: 10px; font-weight: 900; color: var(--primary); text-transform: uppercase; letter-spacing: 2px; margin-bottom: 15px; text-align: center; }
        .badge-live { background: rgba(239, 68, 68, 0.1); color: var(--primary); padding: 6px 14px; border-radius: 50px; font-size: 10px; font-weight: 900; display: table; margin: 0 auto 20px auto; border: 1px solid var(--primary); }
        h1 { font-size: 28px; font-weight: 900; line-height: 1.1; margin-bottom: 20px; text-transform: uppercase; text-align: center; }
        h1 span { color: var(--primary); }
        .step-title { font-size: 22px; font-weight: 800; margin-bottom: 25px; line-height: 1.2; text-align: center; }
        .options-grid { display: grid; gap: 12px; }
        .option-item { background: #1a1a1a; border: 1px solid var(--border); border-radius: 14px; padding: 20px; cursor: pointer; text-align: center; width: 100%; color: var(--text); font-size: 17px; font-weight: 700; transition: 0.2s; }
        .option-item:active { transform: scale(0.97); background: var(--primary); }
        .cta-btn { background: var(--primary); color: white; width: 100%; padding: 22px; border-radius: 14px; font-size: 18px; font-weight: 900; border: none; cursor: pointer; text-transform: uppercase; margin-top: 25px; box-shadow: 0 10px 25px rgba(239, 68, 68, 0.4); }
        .progress-bar { height: 5px; background: var(--border); border-radius: 10px; margin-bottom: 25px; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--primary); width: 0%; transition: 0.4s; }
        .footer-text { font-size: 11px; color: var(--muted); text-align: center; margin-top: 25px; font-weight: 600; }
        .loader { border: 3px solid var(--border); border-top: 3px solid var(--primary); border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; margin: 20px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div class="quiz-card" id="app"><div class="loader"></div></div>
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, set, update, get, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';
        
        const firebaseConfig = {
            apiKey: "AIzaSyCDYmSVU2xVVuLw0vu3svKI7n4hvdxjW0w",
            authDomain: "projeto-tripe-oficial.firebaseapp.com",
            databaseURL: "https://projeto-tripe-oficial-default-rtdb.firebaseio.com",
            projectId: "projeto-tripe-oficial",
            storageBucket: "projeto-tripe-oficial.firebasestorage.app",
            messagingSenderId: "274742031259",
            appId: "1:274742031259:web:18dc5c086fe3d58b56673e"
        };

        const COPY_VARIANTS = {
            saudacao: [
                "VOC√ä EST√Å A UM PASSO DE TER UM <span>P√äNIS MAIOR E MAIS GROSSO</span>",
                "DESCUBRA COMO <span>AUMENTAR SEU MEMBRO</span> EM AT√â 5CM NATURALMENTE",
                "O SEGREDO PARA <span>ENGROSSAR E CRESCER</span> SEU P√äNIS FOI REVELADO",
                "PARE DE SOFRER COM O TAMANHO: <span>CRES√áA SEU P√äNIS</span> AGORA",
                "DIAGN√ìSTICO DE <span>POTENCIAL PENIANO</span>: VEJA QUANTO PODE CRESCER"
            ],
            questions: [
                ["Qual o tamanho do seu p√™nis ereto hoje?", "Quanto mede seu membro quando est√° duro?", "Qual sua medida atual de comprimento?", "Qual o tamanho do seu p√™nis agora?", "Quanto voc√™ mede ereto?"],
                ["Voc√™ acorda com o p√™nis duro?", "Tem ere√ß√µes matinais fortes?", "Sente o membro r√≠gido ao acordar?", "Sua ere√ß√£o matinal √© frequente?", "Acorda com o p√™nis ereto?"],
                ["J√° tentou algum m√©todo para aumentar?", "J√° usou algo para crescer o p√™nis?", "J√° tentou engrossar o membro antes?", "√â sua primeira vez tentando aumentar?", "J√° buscou aumentar o tamanho?"],
                ["Sua alimenta√ß√£o √© boa ou ruim?", "Voc√™ come muita porcaria?", "Sua dieta ajuda ou atrapalha?", "Como est√° sua nutri√ß√£o hoje?", "Voc√™ come bem no dia a dia?"],
                ["Dorme bem ou vive cansado?", "Quantas horas voc√™ dorme?", "Seu sono √© profundo?", "Voc√™ descansa o suficiente?", "Dorme mais de 7 horas?"],
                ["Voc√™ faz algum exerc√≠cio?", "Pratica atividade f√≠sica?", "Treina com frequ√™ncia?", "√â uma pessoa ativa?", "Faz academia ou esportes?"],
                ["Qual a sua idade?", "Quantos anos voc√™ tem?", "Em que faixa et√°ria est√°?", "Qual sua idade atual?", "Quantos anos?"],
            ],
            resultado: [
                "üî• SEU P√äNIS PODE CRESCER MUITO",
                "üöÄ RESULTADO: VOC√ä TEM ALTO POTENCIAL",
                "‚ö†Ô∏è BLOQUEIOS DE CRESCIMENTO DETECTADOS",
                "‚úÖ PROTOCOLO DE AUMENTO LIBERADO",
                "üí™ AN√ÅLISE: PREPARE-SE PARA CRESCER"
            ],
            cta: [
                "üî• QUERO MEU P√äNIS MAIOR AGORA",
                "üí™ QUERO ENGROSSAR MEU MEMBRO",
                "üöÄ LIBERAR MEU ACESSO AGORA",
                "‚úÖ QUERO CRESCER 5CM",
                "üîì QUERO O M√âTODO AGORA"
            ]
        };

        let db, userRef;
        let currentStep = 0;
        let answers = {};
        let selectedVariants = { saudacao: 0, questions: [0,0,0,0,0,0,0], resultado: 0, cta: 0 };
        let stepStartTime = 0;
        const sessionId = 'user_' + Date.now( ) + '_' + Math.random().toString(36).substr(2, 5);

        async function trackStep(step, name) { if (userRef) await update(userRef, { currentStep: step, stepName: name, lastUpdate: serverTimestamp() }); }
        
        async function trackMetric(path, value = 1) {
            const r = ref(db, path);
            const snap = await get(r);
            const currentVal = snap.val() || 0;
            await update(ref(db, path.substring(0, path.lastIndexOf('/'))), { [path.split('/').pop()]: currentVal + value });
        }

        async function trackHesitation(variantIdx, step, time) {
            const path = 'optimization/metrics/hesitation/v' + variantIdx + '/step' + step;
            const snap = await get(ref(db, path));
            const data = snap.val() || { totalTime: 0, count: 0 };
            await update(ref(db, path), {
                totalTime: data.totalTime + time,
                count: data.count + 1
            });
        }

        function render() {
            const app = document.getElementById('app');
            stepStartTime = Date.now();

            if (currentStep === 0) {
                app.innerHTML = `
                    <div class="badge-live">‚óè AO VIVO: 1.247 HOMENS ONLINE</div>
                    <h1>${COPY_VARIANTS.saudacao[selectedVariants.saudacao]}</h1>
                    <p style="color: var(--muted); margin-bottom: 25px; font-weight: 600; text-align: center; font-size: 14px;">Responda o diagn√≥stico r√°pido para liberar seu protocolo de aumento.</p>
                    <button class="cta-btn" onclick="window.next()">INICIAR AGORA</button>
                    <p class="footer-text">üîí Seus dados s√£o 100% sigilosos e seguros.</p>
                `;
                trackStep(0, 'Sauda√ß√£o');
                return;
            }
            if (currentStep > 7) { showResult(app); return; }
            
            const qIdx = currentStep - 1;
            const questionText = COPY_VARIANTS.questions[qIdx][selectedVariants.questions[qIdx]];
            const options = [
                ["Menos de 12 cm", "De 12 a 14 cm", "De 14 a 16 cm", "Mais de 16 cm"],
                ["Quase nunca", "Raramente", "√Äs vezes", "Quase sempre"],
                ["Nunca tentei", "J√° ouvi falar", "J√° tentei", "Sim, com disciplina"],
                ["Como muita porcaria", "50/50", "Tento comer bem", "Saud√°vel"],
                ["Menos de 5h", "5h a 6h", "6h a 7h", "8h ou mais"],
                ["Nunca", "1x por semana", "2 a 3x por semana", "4x ou mais"],
                ["18 a 25 anos", "26 a 35 anos", "36 a 45 anos", "Mais de 45 anos"]
            ][qIdx];
            const id = ['tamanho', 'erecao', 'metodo', 'dieta', 'sono', 'treino', 'idade'][qIdx];

            const progress = Math.round((currentStep / 7) * 100);
            let optionsHtml = options.map(opt => `<button class="option-item" onclick="window.selectOption('${id}', '${opt}')">${opt}</button>`).join('');
            
            app.innerHTML = `
                <div class="fixed-header">AVALIA√á√ÉO PERSONALIZADA - M√âTODO TRIPE</div>
                <div class="progress-bar"><div class="progress-fill" style="width: ${progress}%"></div></div>
                <div class="step-title">${questionText}</div>
                <div class="options-grid">${optionsHtml}</div>
                <div class="footer-text">Pergunta ${currentStep} de 7</div>
            `;
            trackStep(currentStep, 'Pergunta ' + currentStep);
        }

        function showResult(app) {
            const ganho = (Math.random() * (5.0 - 1.5) + 1.5).toFixed(1);
            app.innerHTML = `
                <div style="text-align: center;">
                    <div class="badge-live">DIAGN√ìSTICO CONCLU√çDO</div>
                    <h1 style="font-size: 24px;">${COPY_VARIANTS.resultado[selectedVariants.resultado]}</h1>
                    <div style="background: rgba(255,255,255,0.05); padding: 25px; border-radius: 20px; margin: 25px 0; border: 1px solid var(--border);">
                        <p style="font-size: 14px; color: var(--muted); font-weight: 600;">Seu potencial de aumento √© de:</p>
                        <div style="font-size: 56px; font-weight: 900; color: var(--primary); margin: 10px 0;">+${ganho} CM</div>
                        <p style="font-size: 14px; color: var(--muted); font-weight: 600;">Nos pr√≥ximos 30 dias.</p>
                    </div>
                    <button class="cta-btn" onclick="window.finish()">${COPY_VARIANTS.cta[selectedVariants.cta]}</button>
                    <p class="footer-text">‚ö†Ô∏è O acesso ao protocolo pode expirar em breve.</p>
                </div>
            `;
            trackMetric('optimization/variants/resultado_' + selectedVariants.resultado + '/completed');
            trackMetric('optimization/variants/cta_' + selectedVariants.cta + '/completed');
        }

        async function init() {
            try {
                const appInstance = initializeApp(firebaseConfig);
                db = getDatabase(appInstance);
                userRef = ref(db, 'sessions/' + sessionId);
                const statsSnap = await get(ref(db, 'optimization/stats/total_sessions'));
                const totalSessions = (statsSnap.val() || 0) + 1;
                await update(ref(db, 'optimization/stats'), { total_sessions: totalSessions });
                const variantIdx = Math.floor((totalSessions / 10) % 5);
                selectedVariants.saudacao = variantIdx;
                selectedVariants.resultado = variantIdx;
                selectedVariants.cta = variantIdx;
                selectedVariants.questions = [variantIdx, variantIdx, variantIdx, variantIdx, variantIdx, variantIdx, variantIdx];
                const winnerSnap = await get(ref(db, 'optimization/winner'));
                if (winnerSnap.exists()) {
                    const winner = winnerSnap.val();
                    selectedVariants.saudacao = winner.saudacao;
                    selectedVariants.resultado = winner.resultado;
                    selectedVariants.cta = winner.cta;
                }
                await set(userRef, { enteredAt: serverTimestamp(), status: 'active', variants: selectedVariants });
                trackMetric('optimization/variants/saudacao_' + selectedVariants.saudacao + '/tests');
                render();
            } catch (e) { console.error(e); render(); }
        }

        window.selectOption = (id, val) => { 
            const hesitationTime = Date.now() - stepStartTime;
            trackHesitation(selectedVariants.saudacao, currentStep, hesitationTime);
            answers[id] = val; 
            window.next(); 
        };
        window.next = () => { currentStep++; render(); };
        window.finish = async () => {
            if (userRef) {
                await update(userRef, { currentStep: 99, status: 'converted', lastUpdate: serverTimestamp() });
                trackMetric('optimization/variants/resultado_' + selectedVariants.resultado + '/converted');
                trackMetric('optimization/variants/cta_' + selectedVariants.cta + '/converted');
            }
            window.location.href = "https://pay.wiapy.com/w-U6oehEBd";
        };
        init( );
    </script>
</body>
</html>
